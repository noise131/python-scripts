# harbor 工件清理脚本

## 模拟运行

### 1. 模拟运行保留从未 pull 过的工件

```shell
> .\python.exe f:\A_project\py_harbor-image-clean\harbor-clean.py -h 10.0.0.109 -u admin -P 'harbor.123' -m pull -d 60 -s -t all

删除的工件 :
+-------------+------------------+---------------+-------------------+-------+---------------------+---------------------+---------------------+
|   Project   |       Repo       |      Tag      |       Digest      |  Kind |     Create Time     |      Push Time      |      Pull Time      |
+-------------+------------------+---------------+-------------------+-------+---------------------+---------------------+---------------------+
| app_project |       test       |               | sha256:46933b819e | IMAGE | 2022-04-24T15:07:00 | 2022-04-24T15:07:01 | 2022-04-24T15:07:06 |
| app_project |       test       | master-v1.0.0 | sha256:8bcb65fb6d | IMAGE | 2022-04-24T07:50:58 | 2022-04-24T07:51:00 | 2022-04-24T07:51:14 |
| app_project | springboot-test1 |               | sha256:45434d773f | IMAGE | 2022-04-24T11:41:15 | 2022-04-24T11:41:17 | 2022-04-24T11:41:21 |
| app_project | springboot-test1 |               | sha256:ed306acf50 | IMAGE | 2022-04-24T11:38:27 | 2022-04-24T11:38:29 | 2022-04-24T11:38:34 |
| app_project | springboot-test1 |               | sha256:1bc86d96c1 | IMAGE | 2022-04-23T02:07:41 | 2022-04-23T02:07:42 | 2022-04-23T02:07:47 |
| app_project | springboot-test1 |               | sha256:55faa4fdf9 | IMAGE | 2022-04-23T02:05:06 | 2022-04-23T02:05:07 | 2022-04-23T02:05:16 |
| app_project |      redis       | v6.2.6-alpine | sha256:520ed8a68b | IMAGE | 2022-04-11T06:04:22 | 2022-04-11T08:53:20 | 2022-04-11T08:53:33 |
+-------------+------------------+---------------+-------------------+-------+---------------------+---------------------+---------------------+

保留的工件 :
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|   Project   |       Repo       |               Tag                |       Digest      |  Kind |     Create Time     |      Push Time      |      Pull Time      |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|     prod    | registry-photon  |          latest, v2.4.2          | sha256:b15226d63f | IMAGE | 2022-03-15T03:41:18 | 2022-08-07T15:10:00 | 0001-01-01T00:00:00 |      
|     prod    |      alpine      |              latest              | sha256:1e2d5d141b | IMAGE | 2021-03-31T20:10:06 | 2022-08-03T04:51:44 | 0001-01-01T00:00:00 |      
|   k8s-test  |  nginx-pod-test  |        v1.20.2-alpine-v3         | sha256:2fc12c3bbb | IMAGE | 2022-07-17T05:18:16 | 2022-07-19T13:50:16 | 0001-01-01T00:00:00 |      
|   k8s-test  |  nginx-pod-test  |        v1.20.2-alpine-v2         | sha256:43f11b1b75 | IMAGE | 2022-07-16T14:47:42 | 2022-07-19T13:50:08 | 0001-01-01T00:00:00 |      
|   k8s-test  |  nginx-pod-test  |        v1.20.2-alpine-v1         | sha256:1bb50ea310 | IMAGE | 2022-07-16T14:46:04 | 2022-07-19T13:50:04 | 0001-01-01T00:00:00 |      
|    stargz   | springboot-test1 |          develop-v1.0.0          | sha256:9989e085cb | IMAGE | 2022-04-24T13:28:40 | 2022-07-11T16:14:41 | 2022-07-12T02:57:48 |      
|    stargz   | springboot-test1 |          master-v1.0.0           | sha256:e73eee6712 | IMAGE | 2022-04-24T13:14:08 | 2022-07-11T15:57:49 | 2022-07-12T02:54:44 |      
| app_project |       test       | develop-v1.0.0-1, develop-v1.0.0 | sha256:3484b6e710 | IMAGE | 2022-04-24T15:23:53 | 2022-04-24T15:23:54 | 2022-08-03T04:44:40 |      
| app_project | springboot-test1 | develop-v1.0.0-1, develop-v1.0.0 | sha256:08786b45db | IMAGE | 2022-04-24T13:28:40 | 2022-04-24T13:28:41 | 2022-07-19T13:26:56 |      
| app_project | springboot-test1 |          master-v1.0.0           | sha256:86cd5a2b2b | IMAGE | 2022-04-24T13:14:08 | 2022-04-24T13:14:09 | 2022-07-12T02:43:27 |      
| app_project |   app-jar-test   |               v1.0               | sha256:9b9e514e4a | IMAGE | 2022-04-20T02:35:27 | 2022-04-20T03:06:04 | 2022-07-12T04:49:05 |      
| app_project |    nginx-test    |          v1.20.1-alpine          | sha256:eb257453e7 | IMAGE | 2022-04-18T10:42:21 | 2022-04-18T10:45:34 | 2022-07-03T01:22:44 |      
| app_project |    nginx-test    |          v1.20.2-alpine          | sha256:1c3a4a64aa | IMAGE | 2022-04-18T10:44:58 | 2022-04-18T10:45:19 | 2022-07-15T10:02:50 |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      

工件清理完成 ! (simulation : True)
```

### 2. 模拟运行不保留从未 pull 过的工件

```shell
> .\python.exe f:\A_project\py_harbor-image-clean\harbor-clean.py -h 10.0.0.109 -u admin -P 'harbor.123' -m pull -d 60 -s -t all -n

删除的工件 :
+-------------+------------------+-------------------+-------------------+-------+---------------------+---------------------+---------------------+
|   Project   |       Repo       |        Tag        |       Digest      |  Kind |     Create Time     |      Push Time      |      Pull Time      |
+-------------+------------------+-------------------+-------------------+-------+---------------------+---------------------+---------------------+
|     prod    | registry-photon  |   latest, v2.4.2  | sha256:b15226d63f | IMAGE | 2022-03-15T03:41:18 | 2022-08-07T15:10:00 | 0001-01-01T00:00:00 |
|     prod    |      alpine      |       latest      | sha256:1e2d5d141b | IMAGE | 2021-03-31T20:10:06 | 2022-08-03T04:51:44 | 0001-01-01T00:00:00 |
|   k8s-test  |  nginx-pod-test  | v1.20.2-alpine-v3 | sha256:2fc12c3bbb | IMAGE | 2022-07-17T05:18:16 | 2022-07-19T13:50:16 | 0001-01-01T00:00:00 |
|   k8s-test  |  nginx-pod-test  | v1.20.2-alpine-v2 | sha256:43f11b1b75 | IMAGE | 2022-07-16T14:47:42 | 2022-07-19T13:50:08 | 0001-01-01T00:00:00 |
|   k8s-test  |  nginx-pod-test  | v1.20.2-alpine-v1 | sha256:1bb50ea310 | IMAGE | 2022-07-16T14:46:04 | 2022-07-19T13:50:04 | 0001-01-01T00:00:00 |
| app_project |       test       |                   | sha256:46933b819e | IMAGE | 2022-04-24T15:07:00 | 2022-04-24T15:07:01 | 2022-04-24T15:07:06 |
| app_project |       test       |   master-v1.0.0   | sha256:8bcb65fb6d | IMAGE | 2022-04-24T07:50:58 | 2022-04-24T07:51:00 | 2022-04-24T07:51:14 |
| app_project | springboot-test1 |                   | sha256:45434d773f | IMAGE | 2022-04-24T11:41:15 | 2022-04-24T11:41:17 | 2022-04-24T11:41:21 |
| app_project | springboot-test1 |                   | sha256:ed306acf50 | IMAGE | 2022-04-24T11:38:27 | 2022-04-24T11:38:29 | 2022-04-24T11:38:34 |
| app_project | springboot-test1 |                   | sha256:1bc86d96c1 | IMAGE | 2022-04-23T02:07:41 | 2022-04-23T02:07:42 | 2022-04-23T02:07:47 |
| app_project | springboot-test1 |                   | sha256:55faa4fdf9 | IMAGE | 2022-04-23T02:05:06 | 2022-04-23T02:05:07 | 2022-04-23T02:05:16 |
| app_project |      redis       |   v6.2.6-alpine   | sha256:520ed8a68b | IMAGE | 2022-04-11T06:04:22 | 2022-04-11T08:53:20 | 2022-04-11T08:53:33 |
+-------------+------------------+-------------------+-------------------+-------+---------------------+---------------------+---------------------+

保留的工件 :
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|   Project   |       Repo       |               Tag                |       Digest      |  Kind |     Create Time     |      Push Time      |      Pull Time      |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|    stargz   | springboot-test1 |          develop-v1.0.0          | sha256:9989e085cb | IMAGE | 2022-04-24T13:28:40 | 2022-07-11T16:14:41 | 2022-07-12T02:57:48 |      
|    stargz   | springboot-test1 |          master-v1.0.0           | sha256:e73eee6712 | IMAGE | 2022-04-24T13:14:08 | 2022-07-11T15:57:49 | 2022-07-12T02:54:44 |      
| app_project |       test       | develop-v1.0.0-1, develop-v1.0.0 | sha256:3484b6e710 | IMAGE | 2022-04-24T15:23:53 | 2022-04-24T15:23:54 | 2022-08-03T04:44:40 |      
| app_project | springboot-test1 | develop-v1.0.0-1, develop-v1.0.0 | sha256:08786b45db | IMAGE | 2022-04-24T13:28:40 | 2022-04-24T13:28:41 | 2022-07-19T13:26:56 |      
| app_project | springboot-test1 |          master-v1.0.0           | sha256:86cd5a2b2b | IMAGE | 2022-04-24T13:14:08 | 2022-04-24T13:14:09 | 2022-07-12T02:43:27 |      
| app_project |   app-jar-test   |               v1.0               | sha256:9b9e514e4a | IMAGE | 2022-04-20T02:35:27 | 2022-04-20T03:06:04 | 2022-07-12T04:49:05 |      
| app_project |    nginx-test    |          v1.20.1-alpine          | sha256:eb257453e7 | IMAGE | 2022-04-18T10:42:21 | 2022-04-18T10:45:34 | 2022-07-03T01:22:44 |      
| app_project |    nginx-test    |          v1.20.2-alpine          | sha256:1c3a4a64aa | IMAGE | 2022-04-18T10:44:58 | 2022-04-18T10:45:19 | 2022-07-15T10:02:50 |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      

工件清理完成 ! (simulation : True)
```

## 实际运行

### 1. 输出一个所有工件列表供参考

```shell
> .\python.exe f:\A_project\py_harbor-image-clean\harbor-clean.py -h 10.0.0.109 -u admin -P 'harbor.123' -m pull -d 3650 -s -t retain

保留的工件 :
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|   Project   |       Repo       |               Tag                |       Digest      |  Kind |     Create Time     |      Push Time      |      Pull Time      |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|     prod    | registry-photon  |          latest, v2.4.2          | sha256:b15226d63f | IMAGE | 2022-03-15T03:41:18 | 2022-08-07T15:10:00 | 0001-01-01T00:00:00 |      
|     prod    |      alpine      |              latest              | sha256:1e2d5d141b | IMAGE | 2021-03-31T20:10:06 | 2022-08-03T04:51:44 | 0001-01-01T00:00:00 |      
|   k8s-test  |  nginx-pod-test  |        v1.20.2-alpine-v3         | sha256:2fc12c3bbb | IMAGE | 2022-07-17T05:18:16 | 2022-07-19T13:50:16 | 0001-01-01T00:00:00 |      
|   k8s-test  |  nginx-pod-test  |        v1.20.2-alpine-v2         | sha256:43f11b1b75 | IMAGE | 2022-07-16T14:47:42 | 2022-07-19T13:50:08 | 0001-01-01T00:00:00 |      
|   k8s-test  |  nginx-pod-test  |        v1.20.2-alpine-v1         | sha256:1bb50ea310 | IMAGE | 2022-07-16T14:46:04 | 2022-07-19T13:50:04 | 0001-01-01T00:00:00 |      
|    stargz   | springboot-test1 |          develop-v1.0.0          | sha256:9989e085cb | IMAGE | 2022-04-24T13:28:40 | 2022-07-11T16:14:41 | 2022-07-12T02:57:48 |      
|    stargz   | springboot-test1 |          master-v1.0.0           | sha256:e73eee6712 | IMAGE | 2022-04-24T13:14:08 | 2022-07-11T15:57:49 | 2022-07-12T02:54:44 |      
| app_project |       test       | develop-v1.0.0-1, develop-v1.0.0 | sha256:3484b6e710 | IMAGE | 2022-04-24T15:23:53 | 2022-04-24T15:23:54 | 2022-08-03T04:44:40 |      
| app_project |       test       |                                  | sha256:46933b819e | IMAGE | 2022-04-24T15:07:00 | 2022-04-24T15:07:01 | 2022-04-24T15:07:06 |      
| app_project |       test       |          master-v1.0.0           | sha256:8bcb65fb6d | IMAGE | 2022-04-24T07:50:58 | 2022-04-24T07:51:00 | 2022-04-24T07:51:14 |      
| app_project | springboot-test1 | develop-v1.0.0-1, develop-v1.0.0 | sha256:08786b45db | IMAGE | 2022-04-24T13:28:40 | 2022-04-24T13:28:41 | 2022-07-19T13:26:56 |      
| app_project | springboot-test1 |          master-v1.0.0           | sha256:86cd5a2b2b | IMAGE | 2022-04-24T13:14:08 | 2022-04-24T13:14:09 | 2022-07-12T02:43:27 |      
| app_project | springboot-test1 |                                  | sha256:45434d773f | IMAGE | 2022-04-24T11:41:15 | 2022-04-24T11:41:17 | 2022-04-24T11:41:21 |      
| app_project | springboot-test1 |                                  | sha256:ed306acf50 | IMAGE | 2022-04-24T11:38:27 | 2022-04-24T11:38:29 | 2022-04-24T11:38:34 |      
| app_project | springboot-test1 |                                  | sha256:1bc86d96c1 | IMAGE | 2022-04-23T02:07:41 | 2022-04-23T02:07:42 | 2022-04-23T02:07:47 |      
| app_project | springboot-test1 |                                  | sha256:55faa4fdf9 | IMAGE | 2022-04-23T02:05:06 | 2022-04-23T02:05:07 | 2022-04-23T02:05:16 |      
| app_project |   app-jar-test   |               v1.0               | sha256:9b9e514e4a | IMAGE | 2022-04-20T02:35:27 | 2022-04-20T03:06:04 | 2022-07-12T04:49:05 |      
| app_project |    nginx-test    |          v1.20.1-alpine          | sha256:eb257453e7 | IMAGE | 2022-04-18T10:42:21 | 2022-04-18T10:45:34 | 2022-07-03T01:22:44 |      
| app_project |    nginx-test    |          v1.20.2-alpine          | sha256:1c3a4a64aa | IMAGE | 2022-04-18T10:44:58 | 2022-04-18T10:45:19 | 2022-07-15T10:02:50 |      
| app_project |      redis       |          v6.2.6-alpine           | sha256:520ed8a68b | IMAGE | 2022-04-11T06:04:22 | 2022-04-11T08:53:20 | 2022-04-11T08:53:33 |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      

工件清理完成 ! (simulation : True)
```

### 2. 清理最后一次 pull 为 60 天之前但包留从未 pull 过的工件

```shell
> .\python.exe f:\A_project\py_harbor-image-clean\harbor-clean.py -h 10.0.0.109 -u admin -P 'harbor.123' -m pull -d 60 -t all

删除的工件 :
+-------------+------------------+---------------+-------------------+-------+---------------------+---------------------+---------------------+
|   Project   |       Repo       |      Tag      |       Digest      |  Kind |     Create Time     |      Push Time      |      Pull Time      |
+-------------+------------------+---------------+-------------------+-------+---------------------+---------------------+---------------------+
| app_project |       test       |               | sha256:46933b819e | IMAGE | 2022-04-24T15:07:00 | 2022-04-24T15:07:01 | 2022-04-24T15:07:06 |
| app_project |       test       | master-v1.0.0 | sha256:8bcb65fb6d | IMAGE | 2022-04-24T07:50:58 | 2022-04-24T07:51:00 | 2022-04-24T07:51:14 |
| app_project | springboot-test1 |               | sha256:45434d773f | IMAGE | 2022-04-24T11:41:15 | 2022-04-24T11:41:17 | 2022-04-24T11:41:21 |
| app_project | springboot-test1 |               | sha256:ed306acf50 | IMAGE | 2022-04-24T11:38:27 | 2022-04-24T11:38:29 | 2022-04-24T11:38:34 |
| app_project | springboot-test1 |               | sha256:1bc86d96c1 | IMAGE | 2022-04-23T02:07:41 | 2022-04-23T02:07:42 | 2022-04-23T02:07:47 |
| app_project | springboot-test1 |               | sha256:55faa4fdf9 | IMAGE | 2022-04-23T02:05:06 | 2022-04-23T02:05:07 | 2022-04-23T02:05:16 |
| app_project |      redis       | v6.2.6-alpine | sha256:520ed8a68b | IMAGE | 2022-04-11T06:04:22 | 2022-04-11T08:53:20 | 2022-04-11T08:53:33 |
+-------------+------------------+---------------+-------------------+-------+---------------------+---------------------+---------------------+

保留的工件 :
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|   Project   |       Repo       |               Tag                |       Digest      |  Kind |     Create Time     |      Push Time      |      Pull Time      |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|     prod    | registry-photon  |          latest, v2.4.2          | sha256:b15226d63f | IMAGE | 2022-03-15T03:41:18 | 2022-08-07T15:10:00 | 0001-01-01T00:00:00 |      
|     prod    |      alpine      |              latest              | sha256:1e2d5d141b | IMAGE | 2021-03-31T20:10:06 | 2022-08-03T04:51:44 | 0001-01-01T00:00:00 |      
|   k8s-test  |  nginx-pod-test  |        v1.20.2-alpine-v3         | sha256:2fc12c3bbb | IMAGE | 2022-07-17T05:18:16 | 2022-07-19T13:50:16 | 0001-01-01T00:00:00 |      
|   k8s-test  |  nginx-pod-test  |        v1.20.2-alpine-v2         | sha256:43f11b1b75 | IMAGE | 2022-07-16T14:47:42 | 2022-07-19T13:50:08 | 0001-01-01T00:00:00 |      
|   k8s-test  |  nginx-pod-test  |        v1.20.2-alpine-v1         | sha256:1bb50ea310 | IMAGE | 2022-07-16T14:46:04 | 2022-07-19T13:50:04 | 0001-01-01T00:00:00 |      
|    stargz   | springboot-test1 |          develop-v1.0.0          | sha256:9989e085cb | IMAGE | 2022-04-24T13:28:40 | 2022-07-11T16:14:41 | 2022-07-12T02:57:48 |      
|    stargz   | springboot-test1 |          master-v1.0.0           | sha256:e73eee6712 | IMAGE | 2022-04-24T13:14:08 | 2022-07-11T15:57:49 | 2022-07-12T02:54:44 |      
| app_project |       test       | develop-v1.0.0-1, develop-v1.0.0 | sha256:3484b6e710 | IMAGE | 2022-04-24T15:23:53 | 2022-04-24T15:23:54 | 2022-08-03T04:44:40 |      
| app_project | springboot-test1 | develop-v1.0.0-1, develop-v1.0.0 | sha256:08786b45db | IMAGE | 2022-04-24T13:28:40 | 2022-04-24T13:28:41 | 2022-07-19T13:26:56 |      
| app_project | springboot-test1 |          master-v1.0.0           | sha256:86cd5a2b2b | IMAGE | 2022-04-24T13:14:08 | 2022-04-24T13:14:09 | 2022-07-12T02:43:27 |      
| app_project |   app-jar-test   |               v1.0               | sha256:9b9e514e4a | IMAGE | 2022-04-20T02:35:27 | 2022-04-20T03:06:04 | 2022-07-12T04:49:05 |      
| app_project |    nginx-test    |          v1.20.1-alpine          | sha256:eb257453e7 | IMAGE | 2022-04-18T10:42:21 | 2022-04-18T10:45:34 | 2022-07-03T01:22:44 |      
| app_project |    nginx-test    |          v1.20.2-alpine          | sha256:1c3a4a64aa | IMAGE | 2022-04-18T10:44:58 | 2022-04-18T10:45:19 | 2022-07-15T10:02:50 |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      

工件清理完成 ! (simulation : False)
```

### 3. 清理最后一次 pull 为 60 天之前的工件不保留从未 pull 的工件

```shell
> .\python.exe f:\A_project\py_harbor-image-clean\harbor-clean.py -h 10.0.0.109 -u admin -P 'harbor.123' -m pull -d 60 -t all -n

删除的工件 :
+-------------+------------------+-------------------+-------------------+-------+---------------------+---------------------+---------------------+
|   Project   |       Repo       |        Tag        |       Digest      |  Kind |     Create Time     |      Push Time      |      Pull Time      |
+-------------+------------------+-------------------+-------------------+-------+---------------------+---------------------+---------------------+
|     prod    | registry-photon  |   latest, v2.4.2  | sha256:b15226d63f | IMAGE | 2022-03-15T03:41:18 | 2022-08-07T15:10:00 | 0001-01-01T00:00:00 |
|     prod    |      alpine      |       latest      | sha256:1e2d5d141b | IMAGE | 2021-03-31T20:10:06 | 2022-08-03T04:51:44 | 0001-01-01T00:00:00 |
|   k8s-test  |  nginx-pod-test  | v1.20.2-alpine-v3 | sha256:2fc12c3bbb | IMAGE | 2022-07-17T05:18:16 | 2022-07-19T13:50:16 | 0001-01-01T00:00:00 |
|   k8s-test  |  nginx-pod-test  | v1.20.2-alpine-v2 | sha256:43f11b1b75 | IMAGE | 2022-07-16T14:47:42 | 2022-07-19T13:50:08 | 0001-01-01T00:00:00 |
|   k8s-test  |  nginx-pod-test  | v1.20.2-alpine-v1 | sha256:1bb50ea310 | IMAGE | 2022-07-16T14:46:04 | 2022-07-19T13:50:04 | 0001-01-01T00:00:00 |
+-------------+------------------+-------------------+-------------------+-------+---------------------+---------------------+---------------------+

保留的工件 :
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|   Project   |       Repo       |               Tag                |       Digest      |  Kind |     Create Time     |      Push Time      |      Pull Time      |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|    stargz   | springboot-test1 |          develop-v1.0.0          | sha256:9989e085cb | IMAGE | 2022-04-24T13:28:40 | 2022-07-11T16:14:41 | 2022-07-12T02:57:48 |      
|    stargz   | springboot-test1 |          master-v1.0.0           | sha256:e73eee6712 | IMAGE | 2022-04-24T13:14:08 | 2022-07-11T15:57:49 | 2022-07-12T02:54:44 |      
| app_project |       test       | develop-v1.0.0-1, develop-v1.0.0 | sha256:3484b6e710 | IMAGE | 2022-04-24T15:23:53 | 2022-04-24T15:23:54 | 2022-08-03T04:44:40 |      
| app_project | springboot-test1 | develop-v1.0.0-1, develop-v1.0.0 | sha256:08786b45db | IMAGE | 2022-04-24T13:28:40 | 2022-04-24T13:28:41 | 2022-07-19T13:26:56 |      
| app_project | springboot-test1 |          master-v1.0.0           | sha256:86cd5a2b2b | IMAGE | 2022-04-24T13:14:08 | 2022-04-24T13:14:09 | 2022-07-12T02:43:27 |      
| app_project |   app-jar-test   |               v1.0               | sha256:9b9e514e4a | IMAGE | 2022-04-20T02:35:27 | 2022-04-20T03:06:04 | 2022-07-12T04:49:05 |      
| app_project |    nginx-test    |          v1.20.1-alpine          | sha256:eb257453e7 | IMAGE | 2022-04-18T10:42:21 | 2022-04-18T10:45:34 | 2022-07-03T01:22:44 |      
| app_project |    nginx-test    |          v1.20.2-alpine          | sha256:1c3a4a64aa | IMAGE | 2022-04-18T10:44:58 | 2022-04-18T10:45:19 | 2022-07-15T10:02:50 |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      

工件清理完成 ! (simulation : False)
```

> 删除从未 pull 过的工件需要配合 pull 匹配模式才会生效

### 4. 输出剩余工件

```shell
> .\python.exe f:\A_project\py_harbor-image-clean\harbor-clean.py -h 10.0.0.109 -u admin -P 'harbor.123' -m pull -d 3650 -t retain -s

保留的工件 :
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|   Project   |       Repo       |               Tag                |       Digest      |  Kind |     Create Time     |      Push Time      |      Pull Time      |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|    stargz   | springboot-test1 |          develop-v1.0.0          | sha256:9989e085cb | IMAGE | 2022-04-24T13:28:40 | 2022-07-11T16:14:41 | 2022-07-12T02:57:48 |      
|    stargz   | springboot-test1 |          master-v1.0.0           | sha256:e73eee6712 | IMAGE | 2022-04-24T13:14:08 | 2022-07-11T15:57:49 | 2022-07-12T02:54:44 |      
| app_project |       test       | develop-v1.0.0-1, develop-v1.0.0 | sha256:3484b6e710 | IMAGE | 2022-04-24T15:23:53 | 2022-04-24T15:23:54 | 2022-08-03T04:44:40 |      
| app_project | springboot-test1 | develop-v1.0.0-1, develop-v1.0.0 | sha256:08786b45db | IMAGE | 2022-04-24T13:28:40 | 2022-04-24T13:28:41 | 2022-07-19T13:26:56 |      
| app_project | springboot-test1 |          master-v1.0.0           | sha256:86cd5a2b2b | IMAGE | 2022-04-24T13:14:08 | 2022-04-24T13:14:09 | 2022-07-12T02:43:27 |      
| app_project |   app-jar-test   |               v1.0               | sha256:9b9e514e4a | IMAGE | 2022-04-20T02:35:27 | 2022-04-20T03:06:04 | 2022-07-12T04:49:05 |      
| app_project |    nginx-test    |          v1.20.1-alpine          | sha256:eb257453e7 | IMAGE | 2022-04-18T10:42:21 | 2022-04-18T10:45:34 | 2022-07-03T01:22:44 |      
| app_project |    nginx-test    |          v1.20.2-alpine          | sha256:1c3a4a64aa | IMAGE | 2022-04-18T10:44:58 | 2022-04-18T10:45:19 | 2022-07-15T10:02:50 |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      

工件清理完成 ! (simulation : True)
```

> 清理成功

## 排除项目测试

排除指定项目一般用于排除存储基础环境镜像的项目

### 1. 为排除指定项目测试

```shell
> .\python.exe F:\A_project\py_harbor-image-clean\harbor-clean.py -h 10.0.0.109 -u admin -P 'harbor.123' -m push -d 30 -t all -s

删除的工件 :
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|   Project   |       Repo       |               Tag                |       Digest      |  Kind |     Create Time     |      Push Time      |      Pull Time      |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      
|    stargz   | springboot-test1 |          develop-v1.0.0          | sha256:9989e085cb | IMAGE | 2022-04-24T13:28:40 | 2022-07-11T16:14:41 | 2022-07-12T02:57:48 |      
|    stargz   | springboot-test1 |          master-v1.0.0           | sha256:e73eee6712 | IMAGE | 2022-04-24T13:14:08 | 2022-07-11T15:57:49 | 2022-07-12T02:54:44 |      
| app_project |       test       | develop-v1.0.0-1, develop-v1.0.0 | sha256:3484b6e710 | IMAGE | 2022-04-24T15:23:53 | 2022-04-24T15:23:54 | 2022-08-03T04:44:40 |      
| app_project | springboot-test1 | develop-v1.0.0-1, develop-v1.0.0 | sha256:08786b45db | IMAGE | 2022-04-24T13:28:40 | 2022-04-24T13:28:41 | 2022-07-19T13:26:56 |      
| app_project | springboot-test1 |          master-v1.0.0           | sha256:86cd5a2b2b | IMAGE | 2022-04-24T13:14:08 | 2022-04-24T13:14:09 | 2022-07-12T02:43:27 |      
| app_project |   app-jar-test   |               v1.0               | sha256:9b9e514e4a | IMAGE | 2022-04-20T02:35:27 | 2022-04-20T03:06:04 | 2022-07-12T04:49:05 |      
| app_project |    nginx-test    |          v1.20.1-alpine          | sha256:eb257453e7 | IMAGE | 2022-04-18T10:42:21 | 2022-04-18T10:45:34 | 2022-07-03T01:22:44 |      
| app_project |    nginx-test    |          v1.20.2-alpine          | sha256:1c3a4a64aa | IMAGE | 2022-04-18T10:44:58 | 2022-04-18T10:45:19 | 2022-07-15T10:02:50 |      
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+      

保留的工件 :
+---------+------+-----+--------+------+-------------+-----------+-----------+
| Project | Repo | Tag | Digest | Kind | Create Time | Push Time | Pull Time |
+---------+------+-----+--------+------+-------------+-----------+-----------+
+---------+------+-----+--------+------+-------------+-----------+-----------+

工件清理完成 ! (simulation : True)
```

### 2. 排除 app_project 和 stargz 项目

```shell
> .\python.exe F:\A_project\py_harbor-image-clean\harbor-clean.py -h 10.0.0.109 -u admin -P 'harbor.123' -m push -d 30 -t all -s -e app_project,stargz

删除的工件 :
+---------+------+-----+--------+------+-------------+-----------+-----------+
| Project | Repo | Tag | Digest | Kind | Create Time | Push Time | Pull Time |
+---------+------+-----+--------+------+-------------+-----------+-----------+
+---------+------+-----+--------+------+-------------+-----------+-----------+

保留的工件 :
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+    
|   Project   |       Repo       |               Tag                |       Digest      |  Kind |     Create Time     |      Push Time      |      Pull Time      |    
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+    
|    stargz   | springboot-test1 |          develop-v1.0.0          | sha256:9989e085cb | IMAGE | 2022-04-24T13:28:40 | 2022-07-11T16:14:41 | 2022-07-12T02:57:48 |    
|    stargz   | springboot-test1 |          master-v1.0.0           | sha256:e73eee6712 | IMAGE | 2022-04-24T13:14:08 | 2022-07-11T15:57:49 | 2022-07-12T02:54:44 |    
| app_project |       test       | develop-v1.0.0-1, develop-v1.0.0 | sha256:3484b6e710 | IMAGE | 2022-04-24T15:23:53 | 2022-04-24T15:23:54 | 2022-08-03T04:44:40 |    
| app_project | springboot-test1 | develop-v1.0.0-1, develop-v1.0.0 | sha256:08786b45db | IMAGE | 2022-04-24T13:28:40 | 2022-04-24T13:28:41 | 2022-07-19T13:26:56 |    
| app_project | springboot-test1 |          master-v1.0.0           | sha256:86cd5a2b2b | IMAGE | 2022-04-24T13:14:08 | 2022-04-24T13:14:09 | 2022-07-12T02:43:27 |    
| app_project |   app-jar-test   |               v1.0               | sha256:9b9e514e4a | IMAGE | 2022-04-20T02:35:27 | 2022-04-20T03:06:04 | 2022-07-12T04:49:05 |    
| app_project |    nginx-test    |          v1.20.1-alpine          | sha256:eb257453e7 | IMAGE | 2022-04-18T10:42:21 | 2022-04-18T10:45:34 | 2022-07-03T01:22:44 |    
| app_project |    nginx-test    |          v1.20.2-alpine          | sha256:1c3a4a64aa | IMAGE | 2022-04-18T10:44:58 | 2022-04-18T10:45:19 | 2022-07-15T10:02:50 |    
+-------------+------------------+----------------------------------+-------------------+-------+---------------------+---------------------+---------------------+    

工件清理完成 ! (simulation : True)
```
